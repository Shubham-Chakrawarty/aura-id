// THE BRIDGE: The "Visa" (Multi-Context Logic)

enum MembershipStatus {
  ACTIVE
  INACTIVE
  BANNED
  PENDING
}

model ApplicationMembership {
  id            String           @id @default(cuid())
  userId        String           @map("user_id")
  applicationId String           @map("application_id")

  // Permissions & Context
  role          String           @default("USER")
  status        MembershipStatus @default(ACTIVE)
  grantedScopes String[]         @default(["openid", "profile"]) @map("granted_scopes")

  metadata      Json             @default("{}")
  lastAccessedAt DateTime?       @map("last_accessed_at")

  // Lifecycle
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  // Relations
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  application Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  sessions    Session[]

  @@unique([userId, applicationId])
  @@index([userId])
  @@index([applicationId])
  @@map("application_memberships")
}