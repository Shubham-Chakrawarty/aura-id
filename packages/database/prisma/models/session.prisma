// ACCESS CONTROL: Sessions

model Session {
  id            String    @id @default(cuid())
  sid           String    @unique @default(cuid())
  userId        String    @map("user_id")
  applicationId String    @map("application_id")
  membershipId  String    @map("membership_id")

  // Security Context
  revokedAt     DateTime? @map("revoked_at")
  userAgent     String?   @db.Text @map("user_agent")
  ipAddress     String?   @map("ip_address")

  // Lifecycle
  expiresAt     DateTime  @map("expires_at")
  lastActiveAt  DateTime  @default(now()) @map("last_active_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  deletedAt     DateTime? @map("deleted_at")

  // Relations
  user          User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  application   Application           @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  membership    ApplicationMembership @relation(fields: [membershipId], references: [id], onDelete: Cascade)
  refreshTokens RefreshToken[]

  @@index([userId])
  @@index([applicationId])
  @@map("sessions")
}